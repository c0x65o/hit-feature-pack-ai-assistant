# Feature Pack: ai-core
# Global AI assistant overlay that can be mounted once at the shell level.

name: ai-core
title: AI
description: Global AI assistant overlay for HIT apps (shell-level)

# A tiny hidden route exists purely as an install signal (so the app shell can
# detect this pack is enabled via .hit/generated/routes.ts) without relying on
# hit-config having a feature_packs list.
routes:
  - path: /__ai
    page: AiDebug
    roles: []
  - path: /admin/ai/traces
    page: AiTraces
    roles: []
    default_roles_allow: [admin]
    authz: { entity: traces, verb: read, require_mode: any }
  - path: /admin/ai/traces/[correlationId]
    page: AiTraceDetail
    roles: []
    default_roles_allow: [admin]
    authz: { entity: traces, verb: read, require_mode: any }

# Admin-only nav entry for AI observability
nav:
  - id: ai
    label: AI
    icon: Sparkles
    group: system
    roles: [admin]
    showWhen: authenticated
    weight: 905
    children:
      - id: ai-traces
        label: Traces
        path: /admin/ai/traces
        icon: Activity
        weight: 100
        roles: [admin]
        showWhen: authenticated

requires:
  modules:
    - ai

# API routes provided by this pack (AI control plane).
# These are installed into the app as thin wrappers that re-export the server
# handlers from this package, keeping apps clean and feature packs portable.
api:
  routes:
    - path: /api/ai/endpoints
      methods: [GET]
      handler: "@hit/feature-pack-ai-core/server/api/endpoints"
      description: "Capabilities catalog (generated endpoints + modules)."
    - path: /api/ai/endpoints-search
      methods: [GET]
      handler: "@hit/feature-pack-ai-core/server/api/endpoints-search"
      description: "Search endpoints by natural language query."
    - path: /api/ai/methods
      methods: [GET]
      handler: "@hit/feature-pack-ai-core/server/api/methods"
      description: "LLM-friendly method catalog derived from capabilities."
    - path: /api/ai/methods-search
      methods: [GET]
      handler: "@hit/feature-pack-ai-core/server/api/methods-search"
      description: "Search methods by natural language query."
    - path: /api/ai/tools
      methods: [GET]
      handler: "@hit/feature-pack-ai-core/server/api/tools"
      description: "Legacy tool surface (deprecated; wraps methods)."
    - path: /api/ai/execute
      methods: [POST]
      handler: "@hit/feature-pack-ai-core/server/api/execute"
      description: "Execute an approved method (http.request/http.bulk)."
    - path: /api/proxy/ai/[...path]
      methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
      handler: "@hit/feature-pack-ai-core/server/api/proxy-ai"
      description: "Authenticated proxy override for the ai module."

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Action definitions (for admin-core permissions UI + runtime checks)
# ─────────────────────────────────────────────────────────────────────────────
permissions:
  actions:
    # Scope Policy Tree: ai-core (global) -> entity overrides.
    #
    # Scope modes:
    # - none: deny all access for this verb/entity (hide pages + block APIs)
    # - any: ignore scope (read everything)
    # - own: only owned records (not applicable for traces - traces don't have ownership fields)
    # - ldd: owner OR matching L/D/D (not applicable for traces - traces don't have LDD fields)
    #
    # These are mutually exclusive per node; the Security Groups UI renders them as dropdowns.
    - key: ai-core.read.scope.none
      label: "AI Core Read Scope = None"
      description: "Deny all AI Core read access."
      default_enabled: false
    - key: ai-core.read.scope.any
      label: "AI Core Read Scope = Any"
      description: "Read all AI Core entities regardless of scope."
      default_enabled: false
    - key: ai-core.read.scope.own
      label: "AI Core Read Scope = Own"
      description: "Read only AI Core entities you own (not applicable for traces - traces don't have ownership fields)."
      default_enabled: false
    - key: ai-core.read.scope.ldd
      label: "AI Core Read Scope = LDD"
      description: "Read AI Core entities you own, or that match your L/D/D scope (not applicable for traces - traces don't have LDD fields)."
      default_enabled: false

    # Traces override (optional): if set, overrides ai-core.read.scope.* for traces only.
    - key: ai-core.traces.read.scope.none
      label: "AI Core Traces Read Scope = None"
      description: "Deny all trace read access."
      default_enabled: false
    - key: ai-core.traces.read.scope.any
      label: "AI Core Traces Read Scope = Any"
      description: "Read traces regardless of scope."
      default_enabled: false

config:
  schema:
    enabled:
      type: boolean
      default: true
      description: Enable the AI overlay
    model:
      type: string
      default: gpt-4o-mini
      description: Default model for chat
    hide_on_auth_pages:
      type: boolean
      default: true
      description: |
        Automatically hide the AI overlay on authentication pages like /login, 
        /signup, /register, /forgot-password, etc. Set to false to show the 
        overlay on all pages regardless of authentication state.
